CREATE DATABASE EmployeeDB;
USE EmployeeDB;

CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50),
    DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50),
    MGR_NO INT,
    HIREDATE DATE,
    SAL DECIMAL(10,2),
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);

CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PNAME VARCHAR(50),
    PLOC VARCHAR(50)
);

CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10,2),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);
INSERT INTO DEPT VALUES
(10, 'HR', 'Bengaluru'),
(20, 'IT', 'Hyderabad'),
(30, 'Finance', 'Mysuru'),
(40, 'Marketing', 'Chennai'),
(50, 'Admin', 'Delhi');

INSERT INTO EMPLOYEE VALUES
(1001, 'Ravi',  NULL, '2020-03-15', 55000, 10),
(1002, 'Anita', 1001, '2019-08-21', 65000, 20),
(1003, 'Kiran', 1002, '2021-05-10', 48000, 20),
(1004, 'Meena', 1001, '2018-11-11', 72000, 30),
(1005, 'Suresh',1004, '2020-12-25', 50000, 30),
(1006, 'Vijay', 1002, '2022-01-05', 40000, 40);

INSERT INTO PROJECT VALUES
(501, 'Payroll System', 'Bengaluru'),
(502, 'ERP Development', 'Hyderabad'),
(503, 'Banking App', 'Mysuru'),
(504, 'E-Commerce', 'Chennai'),
(505, 'HR Portal', 'Delhi');
select * from PROJECT;

INSERT INTO ASSIGNED_TO VALUES
(1001, 501, 'Manager'),
(1002, 502, 'Developer'),
(1003, 502, 'Tester'),
(1004, 503, 'Analyst'),
(1005, 503, 'Developer'),
(1006, 504, 'Marketing Executive'),
(1002, 501, 'Consultant');

INSERT INTO INCENTIVES VALUES
(1001, '2023-03-10', 3000),
(1002, '2023-04-15', 2000),
(1004, '2023-05-20', 1500),
(1005, '2023-06-05', 1000);

SELECT DISTINCT A.EMPNO
FROM ASSIGNED_TO A
JOIN PROJECT P ON A.PNO = P.PNO
WHERE P.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');

SELECT EMPNO
FROM EMPLOYEE
WHERE EMPNO NOT IN (SELECT EMPNO FROM INCENTIVES);

SELECT E.ENAME,
       E.EMPNO,
       D.DNAME AS DEPARTMENT,
       A.JOB_ROLE,
       D.DLOC AS DEPARTMENT_LOCATION,
       P.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
JOIN ASSIGNED_TO A ON E.EMPNO = A.EMPNO
JOIN PROJECT P ON A.PNO = P.PNO
WHERE D.DLOC = P.PLOC;